<div class="player-container position-fixed bottom-0 start-0 end-0" *ngIf="isInRoom">
  <div class="container-fluid">
    <div class="row align-items-center g-0">
      
      <!-- Song info section -->
      <div class="col-lg-3 col-md-4 col-12">
        <div class="song-info">
          <div class="album-art" 
               [style.background-image]="(currentTrack && currentTrack.coverUrl) ? 'url(' + currentTrack.coverUrl + ')' : 'none'"
               [class.has-cover]="currentTrack && currentTrack.coverUrl">
            <div class="album-placeholder" *ngIf="!currentTrack || !currentTrack.coverUrl">
              <lucide-icon name="music" size="20"></lucide-icon>
            </div>
            <img *ngIf="currentTrack && currentTrack.coverUrl" 
                 [src]="currentTrack.coverUrl" 
                 [alt]="currentTrack.title"
                 (error)="onImageError($event)"
                 style="display: none;">
          </div>
          <div class="track-info">
            <div class="song-title" [title]="currentTrack?.title">
              {{ currentTrack?.title || 'No song selected' }}
            </div>
            <div class="artist-name" [title]="currentTrack?.artist">
              {{ currentTrack?.artist || 'Unknown artist' }}
            </div>
          </div>
        </div>
      </div>
      
      <!-- Playback controls section -->
      <div class="col-lg-6 col-md-4 col-12 order-md-2 order-3">
        <div class="controls-section">
            
          <!-- Playback buttons -->
          <div class="playback-controls">
            <button class="control-btn shuffle-btn" [disabled]="!currentUser" title="Shuffle (Not implemented)">
              <lucide-icon name="shuffle" size="16"></lucide-icon>
            </button>
            <button class="control-btn" 
                    [disabled]="!currentUser || !hasPreviousTrack()" 
                    (click)="previousTrack()"
                    title="Previous track">
              <lucide-icon name="skip-back" size="18"></lucide-icon>
            </button>
            <button class="play-btn" 
                    [disabled]="!currentUser || !currentTrack || !isTrackReady()" 
                    (click)="togglePlay()"
                    [class.playing]="isPlaying"
                    [title]="getPlayButtonTitle()">
              <lucide-icon [name]="isPlaying ? 'pause' : 'play'" size="20"></lucide-icon>
            </button>
            <button class="control-btn" 
                    [disabled]="!currentUser || !hasNextTrack()" 
                    (click)="nextTrack()"
                    title="Next track">
              <lucide-icon name="skip-forward" size="18"></lucide-icon>
            </button>
            <button class="control-btn repeat-btn" [disabled]="!currentUser" title="Repeat (Not implemented)">
              <lucide-icon name="repeat" size="16"></lucide-icon>
            </button>
          </div>
          
          <!-- Progress bar -->
          <div class="progress-section">
            <span class="time-display">{{ formatTime(currentTime) }}</span>
            <div class="progress-container">
              <div class="progress-track" 
                   [class.interactive]="currentUser"
                   (click)="onProgressClick($event)">
                <div class="progress-fill" 
                     [style.width.%]="duration > 0 ? (currentTime / duration) * 100 : 0"></div>
                <div class="progress-handle" 
                     [style.left.%]="duration > 0 ? (currentTime / duration) * 100 : 0"
                     [class.visible]="currentUser"></div>
              </div>
            </div>
            <span class="time-display">{{ formatTime(duration) }}</span>
          </div>
        </div>
      </div>
      
      <!-- Volume and additional controls -->
      <div class="col-lg-3 col-md-4 col-12 order-md-3 order-2">
        <div class="volume-section">            <button class="volume-btn" 
                  (click)="toggleMute()"
                  [title]="isMuted ? 'Unmute' : 'Mute'">
            <lucide-icon [name]="getVolumeIcon()" size="18"></lucide-icon>
          </button>
          <div class="volume-control">
            <div class="volume-track" (click)="onVolumeClick($event)">
              <div class="volume-fill" [style.width.%]="isMuted ? 0 : volume * 100"></div>
              <div class="volume-handle" 
                   [style.left.%]="isMuted ? 0 : volume * 100"></div>
            </div>
          </div>
          <div class="additional-controls">
            <button class="control-btn fullscreen-btn" title="Now playing view (Coming soon)" disabled>
              <lucide-icon name="maximize" size="16"></lucide-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
